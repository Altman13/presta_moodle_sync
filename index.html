<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>Plugin for Moodle and PrestaShop</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
    <script type="text/javascript">

        var url_service
        var url_presta_shop = "http://localhost/presta/api/?output_format=JSON&addresses?schema=blank&ws_key=CTYLCF48F1UD3ZUX3QH16FFUR5KR1TU8"
        var url_moodle = "http://localhost/moodle/webservice/rest/server.php?wstoken"
            + "=e3dfaa1e4e7919dfdd1b1edb66edd3f4&wsfunction=core_course_create_courses\""

        $(document).ready(function () {
            $('#service-choose').on('change', function () {
                console.log(this.value)
                switch (this.value) {
                    case 'presta':
                        console.log('presta')
                        url_service = 'localhost/presta'
                        break;
                    case 'moodle':
                        console.log('moodle')
                        url_service = 'localhost/moodles'
                        break;
                    default:
                        break;
                }
            });
            $(function () {
                jsondata = [
                    { "id": "ajson1", "parent": "#", "text": "Main Category" },
                ];
                createJSTree(jsondata);
            });

            function createJSTree(jsondata) {
                $('#tree').jstree({
                    "core": {
                        "check_callback": true,
                        'data': jsondata
                    },
                    "plugins": ["contextmenu"]
                });
            }

            $("#ajax_btn").click(function (e) {
                var all_node = $('#tree').jstree(true).get_json('#', { flat: true })
                for (let index = 0; index < all_node.length; index++) {
                    const element = all_node[index];
                    console.log("element_parent << " + element.parent + ' '
                        + " element_id << " + element.id
                        + " element_text << " + element.text)
                }

                $.ajax({
                    url: url_presta_shop,
                    data: "<test></test>",
                    type: 'POST',
                    contentType: "text/xml",
                    dataType: "text",
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log(xhr.status);
                        console.log(thrownError);
                    }
                });
                // $.post(url_presta_shop, {
                //     categories: all_node
                // },
                //     function (data) {
                //         console.log('object', data)
                //     },
                // )
            })
        })
    </script>
</head>

<body>
    <div id="tree"></div>
    <div id="container" style="height: 100px; width: 960px; background-color: black;">
        <select name="url" id="service-choose">
            <option value="moodle">moodle</option>
            <option value="presta">presta</option>
        </select>
        <input type="text" value="url">
        <input type="text" value="token">
        <input type="text" value="category">
        <span style="display: block;">
            <input type="button" value="Добавить">
            <input type="button" value="Обновить">
            <input type="button" value="Удалить">
        </span>
    </div>
    <input type="button" id="ajax_btn" value="Отправить">
</body>

</html>